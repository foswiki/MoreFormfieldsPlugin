"use strict";!function(e){var t={minimumInputLength:0,placeholder:"None",url:null,width:"element",multiple:!1,quietMillis:500,sortable:!1,limit:10};function i(i,l){var o=this;o.elem=e(i),o.opts=e.extend({},t,o.elem.data(),l),o.init()}i.prototype.init=function(){var t=this,i=t.elem.val();t.opts.params=e.extend({},t.opts),delete t.opts.params.minimumInputLength,delete t.opts.params.placeholder,delete t.opts.params.url,delete t.opts.params.width,delete t.opts.params.multiple,delete t.opts.params.quietMillis,delete t.opts.params.sortable,delete t.opts.params.valueText,t.elem.select2({allowClear:!0,dropdownCssClass:"ui-dialog",placeholder:t.opts.placeholder,minimumInputLength:t.opts.minimumInputLength,width:t.opts.width,multiple:t.opts.multiple,ajax:{url:t.opts.url,dataType:"json",data:function(i,l){return e.extend({},{q:i,limit:t.opts.limit,page:l},t.opts.params)},results:function(e,i){return e.more=i*t.opts.limit<e.total,e}},initSelection:function(l,o){var s,n;if(t.opts.multiple)s=[],e(i.split(/\s*,\s*/)).each((function(e){n=t.opts.valueText[this]||this;try{n=decodeURIComponent(n),s.push({id:this,text:n})}catch(e){console&&console.error("Error: illegal value in webfield:",n)}}));else{n=t.opts.valueText;try{n=decodeURIComponent(n),s={id:i,text:n}}catch(e){console&&console.error("Error: illegal value in topicfield:",n)}}o(s)},formatResult:function(e){return e.text},formatSelection:function(e){return e.text}}),t.opts.sortable&&t.elem.select2("container").find("ul.select2-choices").sortable({items:"> .select2-search-choice",start:function(){t.elem.select2("onSortStart")},stop:function(){t.elem.select2("onSortEnd")}})},e.fn.webFieldEditor=function(t){return this.each((function(){e.data(this,"webFieldEditor")||e.data(this,"webFieldEditor",new i(this,t))}))},e(".foswikiWebFieldEditor:not(.select2-container)").livequery((function(){e(this).webFieldEditor()}))}(jQuery);
