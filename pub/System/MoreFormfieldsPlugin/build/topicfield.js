"use strict";!function(t){var e={minimumInputLength:0,placeholder:"None",url:null,width:"element",multiple:!1,quietMillis:500,sortable:!1,limit:10,templateName:"moreformfields",definitionName:"select2::topic",relative:"off",web:null,webSelector:null};function o(o,i){var l=this;l.elem=t(o),l.opts=t.extend({},e,l.elem.data(),i),l.init()}o.prototype.init=function(){var e=this,o=e.elem.val(),i=new URL(e.opts.url,window.location.origin);e.opts.params=t.extend({},e.opts),delete e.opts.params.minimumInputLength,delete e.opts.params.placeholder,delete e.opts.params.url,delete e.opts.params.width,delete e.opts.params.multiple,delete e.opts.params.quietMillis,delete e.opts.params.sortable,delete e.opts.params.templateName,delete e.opts.params.definitionName,delete e.opts.params.valueText,delete e.opts.params.webSelector,i.searchParams.forEach((function(t,o){e.opts.params[o]=t})),e.elem.select2({allowClear:!0,dropdownCssClass:"ui-dialog",placeholder:e.opts.placeholder,minimumInputLength:e.opts.minimumInputLength,width:e.opts.width,multiple:e.opts.multiple,ajax:{url:e.opts.url,dataType:"json",type:"post",data:function(o,i){var l=t.extend({},{name:e.opts.templateName,expand:e.opts.definitionName,q:o,limit:e.opts.limit,page:i},e.opts.params);return e.opts.webSelector&&(l.web=t(e.opts.webSelector).val()||l.web),l},results:function(t,o){return t.more=o*e.opts.limit<t.total,t}},initSelection:function(i,l){var a,s;if(e.opts.multiple)a=[],t(o.split(/\s*,\s*/)).each((function(t){s=e.opts.valueText[this]||this;try{s=decodeURIComponent(s),a.push({id:this,text:s,thumbnail:e.opts.thumbnail[this]})}catch(t){console&&console.error("Error: illegal value in topicfield:",s)}}));else{s=e.opts.valueText;try{s=decodeURIComponent(s),a={id:o,text:s,thumbnail:e.opts.thumbnail}}catch(t){console&&console.error("Error: illegal value in topicfield:",s)}}l(a)},formatResult:function(t){return e.formatItem(t)},formatSelection:function(t){return e.formatItem(t)}}),e.opts.sortable&&e.elem.this.select2("container").find("ul.select2-choices").sortable({items:"> .select2-search-choice",start:function(){e.elem.this.select2("onSortStart")},stop:function(){e.elem.this.select2("onSortEnd")}})},o.prototype.formatItem=function(t){return t.thumbnail?"<div class='image-item' style='background-image:url(\""+t.thumbnail+"\")'>"+t.text+"</div>":t.text},t.fn.topicFieldEditor=function(e){return this.each((function(){t.data(this,"topicFieldEditor")||t.data(this,"topicFieldEditor",new o(this,e))}))},t(".foswikiTopicFieldEditor:not(.select2-container)").livequery((function(){t(this).topicFieldEditor()}))}(jQuery);
