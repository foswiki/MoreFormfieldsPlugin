"use strict";jQuery((function(e){var t={minimumInputLength:0,placeholder:"None",url:null,width:"element",multiple:!1,quietMillis:500,sortable:!1};function i(e){return e.thumbnail?"<div class='image-item' style='background-image:url(\""+e.thumbnail+"\")'>"+e.text+"</div>":e.text}function n(e){return e.match(/\.(avif|jpe?g|gif|png|bmp|webp|svg|ico|tiff?|xcf|psd|heic|heif)$/i)?foswiki.getScriptUrlPath("rest","ImagePlugin","resize",{topic:foswiki.getPreference("WEB")+"."+foswiki.getPreference("TOPIC"),file:encodeURIComponent(e),size:"32x32>",crop:"west"}):foswiki.getScriptUrlPath("rest","MimeIconPlugin","get",{topic:foswiki.getPreference("WEB")+"."+foswiki.getPreference("TOPIC"),file:encodeURIComponent(e),size:"32"})}e(".foswikiAttachmentField:not(.inited)").livequery((function(){var l=e(this),o=e.extend({},t,l.data()),a=e.extend({},o),s=l.val();delete a.minimumInputLength,delete a.url,delete a.width,delete a.quietMillis,l.addClass("inited").select2({allowClear:!0,dropdownCssClass:"ui-dialog",placeholder:o.placeholder,minimumInputLength:o.minimumInputLength,width:o.width,multiple:o.multiple,ajax:{url:o.url,dataType:"json",data:function(t,i){return e.extend({},{q:t,limit:10,page:i},a)},results:function(e,t){return e.more=10*t<e.total,e}},initSelection:function(t,i){var l;o.multiple?(l=[],e(s.split(/\s*,\s*/)).each((function(){l.push({id:this,text:decodeURIComponent(this),thumbnail:n(this)})}))):l={id:s,text:s,thumbnail:n(s)},i(l)},formatResult:i,formatSelection:i}),o.sortable&&l.select2("container").find("ul.select2-choices").sortable({items:"> .select2-search-choice",start:function(){l.select2("onSortStart")},stop:function(){l.select2("onSortEnd")}}),l.next(".jqUploadButton").on("afterUpload",(function(t,i){i.forEach((function(t){if(o.acceptFileTypes&&(new RegExp(o.acceptFileTypes).test(t)||(t="")),""!==t){var i=l.select2("data");e.isArray(i)?i.push({id:t,text:t,thumbnail:n(t)}):i={id:t,text:t,thumbnail:n(t)},l.select2("data",i)}}))}))}))}));
